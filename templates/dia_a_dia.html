{% extends "base.html" %}
{% from "components/section_header.html" import section_header %}

{% block title %}Ferramentas Dia-a-dia - G&L Systems{% endblock %}

{% block content %}
<div class="container py-5 mt-5">
    <!-- Hero Section -->
    {{ section_header(
        badge_text="üõ†Ô∏è Ferramentas R√°pidas",
        title="Ferramentas para o Dia-a-dia", 
        subtitle="Tr√™s ferramentas essenciais para facilitar seu trabalho di√°rio - totalmente gr√°tis"
    ) }}

    <!-- Tools Grid -->
    <div class="row g-4 mb-5">
        <!-- PDF Converter -->
        <div class="col-lg-4">
            <div class="tool-card h-100">
                <div class="tool-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <h3 class="tool-title">Conversor para PDF</h3>
                <p class="tool-description">
                    Converta documentos Word, Excel, PowerPoint e imagens para PDF instantaneamente.
                </p>
                <div class="tool-upload-area" id="pdf-converter-area">
                    <div class="upload-content">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <p>Arraste arquivos aqui ou <span class="upload-link">clique para selecionar</span></p>
                        <small>Suporta: DOC, DOCX, XLS, XLSX, PPT, PPTX, JPG, PNG</small>
                    </div>
                    <input type="file" id="pdf-converter-input" class="file-input" accept=".doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png" multiple>
                </div>
                <div class="progress-container" id="pdf-converter-progress" style="display: none;">
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <small class="progress-text">Convertendo...</small>
                </div>
                <div class="download-area" id="pdf-converter-download" style="display: none;">
                    <div class="preview-content"></div>
                </div>
            </div>
        </div>

        <!-- PDF Compressor -->
        <div class="col-lg-4">
            <div class="tool-card h-100">
                <div class="tool-icon">
                    <i class="fas fa-compress-alt"></i>
                </div>
                <h3 class="tool-title">Compressor de PDF</h3>
                <p class="tool-description">
                    Reduza o tamanho de arquivos PDF com n√≠veis de compress√£o personaliz√°veis. Otimiza√ß√£o inteligente.
                </p>
                
                <!-- Compression Level Selection -->
                <div class="compression-options mb-3">
                    <label class="form-label"><i class="fas fa-sliders-h me-2"></i>N√≠vel de Compress√£o:</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="compression-level" id="comp-low" value="low">
                        <label class="btn btn-outline-primary" for="comp-low">
                            <i class="fas fa-feather me-1"></i>Baixa
                            <small class="d-block">M√°xima qualidade</small>
                        </label>
                        
                        <input type="radio" class="btn-check" name="compression-level" id="comp-medium" value="medium" checked>
                        <label class="btn btn-outline-primary" for="comp-medium">
                            <i class="fas fa-balance-scale me-1"></i>M√©dia
                            <small class="d-block">Balanceada</small>
                        </label>
                        
                        <input type="radio" class="btn-check" name="compression-level" id="comp-high" value="high">
                        <label class="btn btn-outline-primary" for="comp-high">
                            <i class="fas fa-compress-arrows-alt me-1"></i>Alta
                            <small class="d-block">M√°xima redu√ß√£o</small>
                        </label>
                    </div>
                </div>
                
                <div class="tool-upload-area" id="pdf-compressor-area">
                    <div class="upload-content">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <p>Arraste seu PDF aqui ou <span class="upload-link">clique para selecionar</span></p>
                        <small>Apenas arquivos PDF</small>
                    </div>
                    <input type="file" id="pdf-compressor-input" class="file-input" accept=".pdf">
                </div>
                <div class="progress-container" id="pdf-compressor-progress" style="display: none;">
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <small class="progress-text">Comprimindo...</small>
                </div>
                <div class="download-area" id="pdf-compressor-download" style="display: none;">
                    <div class="compression-info mb-3">
                        <small class="text-success">Redu√ß√£o: <span id="compression-ratio">0%</span></small>
                    </div>
                    <div class="preview-content"></div>
                </div>
            </div>
        </div>

        <!-- Background Remover -->
        <div class="col-lg-4">
            <div class="tool-card h-100">
                <div class="tool-icon">
                    <i class="fas fa-magic"></i>
                </div>
                <h3 class="tool-title">Removedor de Fundo</h3>
                <p class="tool-description">
                    Remova o fundo de imagens com IA avan√ßada. M√∫ltiplos algoritmos e op√ß√µes de sa√≠da.
                </p>
                
                <!-- AI Model Selection -->
                <div class="bg-options mb-3">
                    <label class="form-label"><i class="fas fa-brain me-2"></i>Modelo de IA:</label>
                    <select class="form-select" id="bg-model">
                        <option value="u2net" selected>U¬≤-Net (Uso geral)</option>
                        <option value="isnet">ISNet (Melhor precis√£o)</option>
                        <option value="silueta">Silhueta (Objetos simples)</option>
                    </select>
                </div>
                
                <!-- Output Options -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label"><i class="fas fa-file-image me-2"></i>Formato:</label>
                        <select class="form-select" id="bg-format">
                            <option value="png" selected>PNG (transparente)</option>
                            <option value="jpg">JPG (com fundo)</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label"><i class="fas fa-palette me-2"></i>Fundo:</label>
                        <select class="form-select" id="bg-color">
                            <option value="transparent" selected>Transparente</option>
                            <option value="white">Branco</option>
                            <option value="black">Preto</option>
                        </select>
                    </div>
                </div>
                
                <!-- Advanced Options -->
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="edge-refine" checked>
                    <label class="form-check-label" for="edge-refine">
                        <i class="fas fa-magic me-1"></i>Refinar bordas automaticamente
                    </label>
                </div>
                
                <div class="tool-upload-area" id="bg-remover-area">
                    <div class="upload-content">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <p>Arraste sua imagem aqui ou <span class="upload-link">clique para selecionar</span></p>
                        <small>Suporta: JPG, PNG (m√°x. 10MB)</small>
                    </div>
                    <input type="file" id="bg-remover-input" class="file-input" accept=".jpg,.jpeg,.png">
                </div>
                <div class="progress-container" id="bg-remover-progress" style="display: none;">
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <small class="progress-text">Removendo fundo...</small>
                </div>
                <div class="download-area" id="bg-remover-download" style="display: none;">
                    <div class="preview-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="row">
        <div class="col-12">
            <div class="features-section">
                <h3 class="text-center mb-4">Por que usar nossas ferramentas?</h3>
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="feature-item text-center">
                            <i class="fas fa-shield-alt feature-icon"></i>
                            <h5>100% Seguro</h5>
                            <p>Seus arquivos s√£o processados localmente. M√°xima privacidade garantida.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-item text-center">
                            <i class="fas fa-rocket feature-icon"></i>
                            <h5>Super R√°pido</h5>
                            <p>Processamento otimizado para resultados em segundos.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-item text-center">
                            <i class="fas fa-gift feature-icon"></i>
                            <h5>Totalmente Gr√°tis</h5>
                            <p>Sem limites, sem cadastro, sem custos ocultos.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-item text-center">
                            <i class="fas fa-cog feature-icon"></i>
                            <h5>F√°cil de Usar</h5>
                            <p>Interface intuitiva. Apenas arraste, solte e baixe.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS -->
<style>
.highlighted-nav {
    background: linear-gradient(135deg, #8a2be2 0%, #ff0080 100%);
    border-radius: 8px;
    color: white !important;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
}

.highlighted-nav:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(138, 43, 226, 0.4);
}

.tool-card {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.tool-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
}

.tool-icon {
    font-size: 4rem;
    background: linear-gradient(135deg, #8a2be2 0%, #ff0080 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1.5rem;
}

.tool-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #1e293b;
}

.tool-description {
    color: #64748b;
    margin-bottom: 2rem;
    line-height: 1.6;
}

.tool-upload-area {
    border: 2px dashed #e2e8f0;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
    position: relative;
    cursor: pointer;
}

.tool-upload-area:hover {
    border-color: #8a2be2;
    background: rgba(138, 43, 226, 0.05);
}

.tool-upload-area.dragover {
    border-color: #8a2be2;
    background: rgba(138, 43, 226, 0.1);
    transform: scale(1.02);
}

.upload-icon {
    font-size: 3rem;
    color: #8a2be2;
    margin-bottom: 1rem;
}

.upload-link {
    color: #8a2be2;
    font-weight: 600;
    cursor: pointer;
}

.file-input {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.progress-container {
    margin-bottom: 1.5rem;
}

.progress {
    height: 8px;
    border-radius: 4px;
    background: #e2e8f0;
    overflow: hidden;
}

.progress-bar {
    background: linear-gradient(90deg, #8a2be2 0%, #ff0080 100%);
    transition: width 0.3s ease;
}

.progress-text {
    color: #64748b;
    margin-top: 0.5rem;
    display: block;
}

.btn-download {
    background: linear-gradient(135deg, #8a2be2 0%, #ff0080 100%);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
}

.btn-download:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(138, 43, 226, 0.4);
}

.preview-container {
    margin-bottom: 1rem;
}

.preview-image {
    max-width: 200px;
    max-height: 200px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.compression-info {
    margin-top: 0.5rem;
    color: #10b981;
    font-weight: 600;
}

.features-section {
    background: linear-gradient(145deg, rgba(248, 250, 252, 0.8), rgba(241, 245, 249, 0.6));
    border-radius: 20px;
    padding: 3rem 2rem;
    margin-top: 3rem;
}

.feature-item {
    padding: 1.5rem;
}

.feature-icon {
    font-size: 2.5rem;
    color: #8a2be2;
    margin-bottom: 1rem;
}

.feature-item h5 {
    font-weight: 700;
    margin-bottom: 1rem;
    color: #1e293b;
}

.feature-item p {
    color: #64748b;
    margin: 0;
}

/* Revolutionary Tool Options Styling */
.compression-options .btn-group .btn {
    flex: 1;
    padding: 0.75rem 0.5rem;
    border-color: rgba(138, 43, 226, 0.3);
    transition: all 0.3s ease;
}

.compression-options .btn-check:checked + .btn {
    background: linear-gradient(135deg, #8a2be2 0%, #6a1b9a 100%);
    border-color: #8a2be2;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(138, 43, 226, 0.3);
}

.compression-options .btn:hover {
    border-color: #8a2be2;
    transform: translateY(-1px);
}

.bg-options .form-select,
.bg-options .form-control {
    border: 2px solid rgba(138, 43, 226, 0.2);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.bg-options .form-select:focus,
.bg-options .form-control:focus {
    border-color: #8a2be2;
    box-shadow: 0 0 0 0.25rem rgba(138, 43, 226, 0.25);
}

.form-check-input:checked {
    background-color: #8a2be2;
    border-color: #8a2be2;
}

.form-check-input:focus {
    box-shadow: 0 0 0 0.25rem rgba(138, 43, 226, 0.25);
}

.form-label {
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.5rem;
}

.compression-options small {
    color: #64748b;
    font-size: 0.75rem;
}
</style>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // PDF Converter
    setupTool('pdf-converter', handlePDFConversion);
    
    // PDF Compressor  
    setupTool('pdf-compressor', handlePDFCompression);
    
    // Background Remover
    setupTool('bg-remover', handleBackgroundRemoval);
    
    function setupTool(toolName, handler) {
        const area = document.getElementById(`${toolName}-area`);
        const input = document.getElementById(`${toolName}-input`);
        
        // Click to upload
        area.addEventListener('click', () => input.click());
        
        // Drag and drop
        area.addEventListener('dragover', (e) => {
            e.preventDefault();
            area.classList.add('dragover');
        });
        
        area.addEventListener('dragleave', () => {
            area.classList.remove('dragover');
        });
        
        area.addEventListener('drop', (e) => {
            e.preventDefault();
            area.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handler(files[0], toolName);
            }
        });
        
        // File input change
        input.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handler(e.target.files[0], toolName);
            }
        });
    }
    
    function showProgress(toolName, text = 'Processando...') {
        document.getElementById(`${toolName}-area`).style.display = 'none';
        const progressContainer = document.getElementById(`${toolName}-progress`);
        progressContainer.style.display = 'block';
        progressContainer.querySelector('.progress-text').textContent = text;
        
        // Simulate progress
        const progressBar = progressContainer.querySelector('.progress-bar');
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 30;
            if (progress > 90) progress = 90;
            progressBar.style.width = progress + '%';
        }, 300);
        
        return interval;
    }
    
    function showPreview(toolName, downloadUrl, filename, fileType) {
        document.getElementById(`${toolName}-progress`).style.display = 'none';
        const downloadArea = document.getElementById(`${toolName}-download`);
        downloadArea.style.display = 'block';
        
        // Create preview content
        const previewContainer = downloadArea.querySelector('.preview-content') || downloadArea;
        
        // Clear previous content
        previewContainer.innerHTML = '';
        
        // Create preview based on file type
        let previewElement;
        if (fileType === 'pdf') {
            previewElement = document.createElement('iframe');
            previewElement.src = downloadUrl;
            previewElement.style.cssText = 'width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px;';
        } else if (fileType === 'image') {
            previewElement = document.createElement('img');
            previewElement.src = downloadUrl;
            previewElement.style.cssText = 'max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px;';
        }
        
        // Add preview title
        const previewTitle = document.createElement('h6');
        previewTitle.innerHTML = '<i class="fas fa-eye me-2"></i>Preview do arquivo processado:';
        previewTitle.style.marginBottom = '10px';
        
        // Add download button
        const downloadBtn = document.createElement('a');
        downloadBtn.href = downloadUrl;
        downloadBtn.download = filename;
        downloadBtn.className = 'btn btn-success btn-lg me-2';
        downloadBtn.innerHTML = '<i class="fas fa-download me-2"></i>Baixar Arquivo';
        
        // Add reset button
        const resetBtn = document.createElement('button');
        resetBtn.className = 'btn btn-secondary';
        resetBtn.innerHTML = '<i class="fas fa-redo me-2"></i>Processar Outro';
        resetBtn.onclick = () => resetTool(toolName);
        
        // Build the preview area
        previewContainer.appendChild(previewTitle);
        if (previewElement) {
            previewContainer.appendChild(previewElement);
        }
        
        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'text-center mt-3';
        buttonContainer.appendChild(downloadBtn);
        buttonContainer.appendChild(resetBtn);
        previewContainer.appendChild(buttonContainer);
    }
    
    function resetTool(toolName) {
        document.getElementById(`${toolName}-download`).style.display = 'none';
        document.getElementById(`${toolName}-progress`).style.display = 'none';
        document.getElementById(`${toolName}-area`).style.display = 'block';
        
        // Reset file input
        const input = document.getElementById(`${toolName}-input`);
        if (input) input.value = '';
        
        // Reset compression ratio if exists
        const ratioElement = document.getElementById('compression-ratio');
        if (ratioElement) ratioElement.textContent = '';
    }
    
    function handlePDFConversion(file, toolName) {
        const interval = showProgress(toolName, 'Convertendo para PDF...');
        
        const formData = new FormData();
        formData.append('file', file);
        
        fetch('/api/convert-to-pdf', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            clearInterval(interval);
            const progressBar = document.querySelector(`#${toolName}-progress .progress-bar`);
            progressBar.style.width = '100%';
            
            if (response.ok) {
                return response.blob();
            } else {
                throw new Error('Conversion failed');
            }
        })
        .then(blob => {
            const url = URL.createObjectURL(blob);
            showPreview(toolName, url, file.name.replace(/\.[^/.]+$/, '') + '.pdf', 'pdf');
        })
        .catch(error => {
            clearInterval(interval);
            alert('Erro na convers√£o: ' + error.message);
            document.getElementById(`${toolName}-progress`).style.display = 'none';
            document.getElementById(`${toolName}-area`).style.display = 'block';
        });
    }
    
    function handlePDFCompression(file, toolName) {
        const interval = showProgress(toolName, 'Comprimindo PDF...');
        
        // Get compression level
        const compressionLevel = document.querySelector('input[name="compression-level"]:checked').value;
        
        const formData = new FormData();
        formData.append('file', file);
        formData.append('level', compressionLevel);
        
        fetch('/api/compress-pdf', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            clearInterval(interval);
            const progressBar = document.querySelector(`#${toolName}-progress .progress-bar`);
            progressBar.style.width = '100%';
            
            if (response.ok) {
                // Get compression statistics from headers
                const originalSize = response.headers.get('X-Original-Size');
                const compressedSize = response.headers.get('X-Compressed-Size');
                const compressionRatio = response.headers.get('X-Compression-Ratio');
                
                if (compressionRatio) {
                    document.getElementById('compression-ratio').textContent = compressionRatio + '%';
                }
                
                return response.blob();
            } else {
                throw new Error('Compression failed');
            }
        })
        .then(blob => {
            const url = URL.createObjectURL(blob);
            showPreview(toolName, url, file.name.replace('.pdf', '_compressed.pdf'), 'pdf');
        })
        .catch(error => {
            clearInterval(interval);
            alert('Erro na compress√£o: ' + error.message);
            document.getElementById(`${toolName}-progress`).style.display = 'none';
            document.getElementById(`${toolName}-area`).style.display = 'block';
        });
    }
    
    function handleBackgroundRemoval(file, toolName) {
        const interval = showProgress(toolName, 'Removendo fundo...');
        
        // Get background removal options
        const model = document.getElementById('bg-model').value;
        const format = document.getElementById('bg-format').value;
        const bgColor = document.getElementById('bg-color').value;
        const edgeRefine = document.getElementById('edge-refine').checked;
        
        const formData = new FormData();
        formData.append('file', file);
        formData.append('model', model);
        formData.append('format', format);
        formData.append('bg_color', bgColor);
        formData.append('edge_refine', edgeRefine.toString());
        
        fetch('/api/remove-background', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            clearInterval(interval);
            const progressBar = document.querySelector(`#${toolName}-progress .progress-bar`);
            progressBar.style.width = '100%';
            
            if (response.ok) {
                return response.blob();
            } else {
                throw new Error('Background removal failed');
            }
        })
        .then(blob => {
            const url = URL.createObjectURL(blob);
            const format = document.getElementById('bg-format').value;
            const filename = file.name.replace(/\.[^/.]+$/, '') + `_no_bg.${format}`;
            showPreview(toolName, url, filename, 'image');
        })
        .catch(error => {
            clearInterval(interval);
            alert('Erro na remo√ß√£o de fundo: ' + error.message);
            document.getElementById(`${toolName}-progress`).style.display = 'none';
            document.getElementById(`${toolName}-area`).style.display = 'block';
        });
    }
});
</script>
{% endblock %}